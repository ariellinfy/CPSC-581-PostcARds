<!DOCTYPE html>
<html lang="en">
  <head>
    <title>AR Postcard</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.2.0/socket.io.js"></script>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/create.css">
    <script type="text/javascript" src="js/landmarks.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    
  </head>
  <body>
    <h1>Create Your Postcard</h1>
    <div class="landmark-wrapper">
        <label for="select-landmark">Landmark:</label>
        <select id="select-landmark" name="select-landmark"></select>
        <a-scene background="color: #FAFAFA" embedded>
          <a-entity id="preview-gltf" 
                    position="0 0 -6" 
                    gltf-model="https://cdn.glitch.global/e76c002c-c9da-46f1-9730-df8080677b3f/eiffel.glb?v=1702601607283"
                    scale = "0.15 0.15 0.15">
          </a-entity>
          <a-text id="preview-txt"
                  value="" 
                  scale="2 2 1" 
                  color="black"
                  position="-5 -2 -6"
                  width="5"
                  wrap-count="30">
          </a-text>
        </a-scene> 
    </div>
    
    <div class="message-wrapper">
        <label for="message">Your Message:</label>
        <textarea id="message" name="message" rows="5" cols="50" placeholder="message..."></textarea>
    </div>

    <div class="button-wrapper">
        <button class="button-56 secondaryBtn" role="button" id="backBtn">
          Back
        </button>
        <button class="button-56 primaryBtn" role="button" id="createBtn">
          Create
        </button>
    </div>
  </body>

  <script>
    Object.keys(Landmarks).forEach(landmark => {
      console.log(landmark)
      $("#select-landmark").append(`<option value="${landmark}">${landmark.charAt(0).toUpperCase() + landmark.slice(1)}</option>`)
    })
    
    $("#select-landmark").change(function(e) {
      var selected = $("#select-landmark :selected").val();
      var res = Landmarks[selected]["baseUrl"];
      var scale = Landmarks[selected]["previewScale"];
      $("#preview-gltf").attr("gltf-model", res);
      $("#preview-gltf").attr("scale", scale);
    });
    
    var textArea = document.getElementById("message");
    var aText = document.getElementById("preview-txt");
    textArea.addEventListener('input', () => {
      text = textArea.value;
      aText.setAttribute('value', text);
    });
    
    var address = window.location.href;
    var root = address.substring(0, address.lastIndexOf("/") + 1);
    var who = address.substring(address.lastIndexOf("=") + 1);
    
    $(document).ready(() => {
      $("#backBtn").click(function() {
        var back = root;
        window.location.href = back;
      });
    });
    
    $(document).ready(() => {
      $("#createBtn").click(function() {
        console.log("creating postcard");

        // assign user selected data here for setup
        var userName = who;
        var landmark = $("#select-landmark").val();
        var message = $("#input-message").val();

        if (userName) {          
          var data = {
            username: userName,
            landmark: landmark,
            message: message
          }
          
          // allPostcards[] = "";
          // socket.emit("new-postcard", data);
          
          // redirect to address with query parameters room for socket
          var join = root + "lobby" + `?name=${who}`;
          window.location.href = join;
        }
      });
    });
  </script>
</html>
